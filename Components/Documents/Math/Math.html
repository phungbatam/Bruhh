<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th∆∞ vi·ªán t√†i li·ªáu To√°n</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

    <link rel="stylesheet" href="Math.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            background: linear-gradient(to right, #00c6ff, #0072ff);
        }

        .sidebar {
            background-color: #0072ff;
            padding: 15px;
            width: 250px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .sidebar h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .sidebar a {
            color: #fff;
            text-decoration: none;
            padding: 10px;
            margin: 5px 0;
            background-color: #0051cc;
            border-radius: 5px;
            text-align: center;
        }

        .sidebar a:hover {
            background-color: #003c99;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            width: 100%;
        }

        .container {
            max-width: 1300px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
        }

        input {
            width: 80%;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px solid #0072ff;
            border-radius: 5px;
            font-size: 16px;
        }

        .doc-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .doc-card {
            width: 280px;
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
            transition: transform 0.3s ease;
        }

        .doc-card:hover {
            transform: scale(1.05);
        }

        .doc-card img {
            width: 100%;
            border-radius: 10px;
            cursor: pointer;
        }

        .doc-card h3 {
            margin: 10px 0;
            font-size: 18px;
        }

        .doc-card p {
            font-size: 14px;
            color: #555;
        }

        .download-btn {
            display: block;
            text-align: center;
            background: #0072ff;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #0051cc;
        }

        .back-btn {
            margin-top: 20px;
            background: #ff4d4d;
            padding: 10px;
            border: none;
            border-radius: 5px;
        }

        .back-btn a {
            color: white;
            text-decoration: none;
        }

        /* Lightbox Styles */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
        }

        .lightbox.active {
            display: flex;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <h2>Ch·ªçn L·ªõp</h2>
        <a href="#" onclick="filterByClass('Ten')">L·ªõp 10</a>
        <a href="#" onclick="filterByClass('Eleven')">L·ªõp 11</a>
        <a href="#" onclick="filterByClass('Twelve')">L·ªõp 12</a>
    </div>

    <div class="main-content">
        <div class="container">
            <h1>üìö Th∆∞ vi·ªán t√†i li·ªáu To√°n</h1>
            <input type="text" id="search" placeholder="üîç T√¨m ki·∫øm t√†i li·ªáu..." onkeyup="filterDocs()">
            <div class="doc-list" id="docList"></div>
            <!-- ƒêo·∫°n m√£ th√™m v√†o hi·ªÉn th·ªã ƒë∆∞·ªùng d·∫´n c·ªßa .doc-card -->
            <div class="doc-paths" id="docPaths"></div>
            <button class="back-btn"><a href="https://phungbatam.github.io/Bruhh">üîô Quay l·∫°i</a></button>
        </div>
    </div>

    <script>
        // Gi·∫£ s·ª≠ b·∫°n ƒë√£ c√≥ danh s√°ch t√†i li·ªáu, m·ªói t√†i li·ªáu c√≥ thu·ªôc t√≠nh 'path' cho ƒë∆∞·ªùng d·∫´n
        const docs = [
            { name: "L·ªõp 10 To√°n", path: "/documents/class10/doc1.docx" },
            { name: "L·ªõp 11 To√°n", path: "/documents/class11/doc2.docx" },
            { name: "L·ªõp 12 To√°n", path: "/documents/class12/doc3.docx" }
        ];

        // H√†m hi·ªÉn th·ªã c√°c t√†i li·ªáu trong .doc-list v√† hi·ªÉn th·ªã ƒë∆∞·ªùng d·∫´n
        function displayDocs() {
            const docList = document.getElementById("docList");
            const docPaths = document.getElementById("docPaths");

            // X√≥a c√°c ph·∫ßn t·ª≠ c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã m·ªõi
            docList.innerHTML = '';
            docPaths.innerHTML = '';

            docs.forEach(doc => {
                // T·∫°o th·∫ª div cho m·ªói t√†i li·ªáu v√† th√™m v√†o docList
                const docCard = document.createElement('div');
                docCard.classList.add('doc-card');
                docCard.innerHTML = `
            <h3>${doc.name}</h3>
            <a href="${doc.path}" target="_blank">Xem t√†i li·ªáu</a>
        `;
                docList.appendChild(docCard);

                // T·∫°o th·∫ª div cho ƒë∆∞·ªùng d·∫´n t√†i li·ªáu v√† th√™m v√†o docPaths
                const docPath = document.createElement('div');
                docPath.classList.add('doc-path');
                docPath.innerText = `ƒê∆∞·ªùng d·∫´n: ${doc.path}`;
                docPaths.appendChild(docPath);
            });
        }

        // G·ªçi h√†m displayDocs khi trang ƒë∆∞·ª£c t·∫£i
        window.onload = displayDocs;

    </script>

    <!-- <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <img id="lightboxImage" src="" alt="Preview" style="max-width: 90%; max-height: 90%;" />
        <canvas id="lightboxCanvas" style="max-width: 90%; max-height: 90%; display: none;"></canvas>
    </div> -->

    <!-- <script src="./Math.js"></script> -->
    <script>
        async function fetchDocumentsByClass(className) {
            const directories = {
                'Ten': "    class/Ten",
                'Eleven': "class/Eleven",
                'Twelve': "class/Twelve"
            };

            const selectedClass = directories[className];
            const allDocuments = [];

            try {
                const response = await fetch(selectedClass);
                const text = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(text, "text/html");
                const links = Array.from(doc.querySelectorAll("a"))
                    .map(a => a.href)
                    .filter(href => href.endsWith(".pdf") || href.endsWith(".docx")); // Th√™m ƒëi·ªÅu ki·ªán cho .docx

                allDocuments.push(...links.map(file => ({
                    title: formatTitle(file),
                    file: file
                })));
            } catch (error) {
                console.error(`L·ªói khi l·∫•y danh s√°ch file t·ª´ th∆∞ m·ª•c ${selectedClass}:`, error);
            }

            return allDocuments;
        }

        // H√†m format ti√™u ƒë·ªÅ t√†i li·ªáu
        function formatTitle(filename) {
            return decodeURIComponent(filename.split("/").pop().replace(".pdf", "").replace(/_/g, " "));
        }

        // H√†m load t√†i li·ªáu theo l·ªõp h·ªçc
        async function loadDocumentsForClass(className) {
            const documents = await fetchDocumentsByClass(className);
            window.allDocuments = documents;
            window.currentClass = className;  // C·∫≠p nh·∫≠t l·ªõp h·ªçc hi·ªán t·∫°i
            const docList = document.getElementById("docList");
            docList.innerHTML = "";

            documents.forEach(doc => {
                const docCard = createDocCard(doc);
                docList.appendChild(docCard);
            });
        }

        // H√†m t·∫°o th·∫ª t√†i li·ªáu
        function createDocCard(doc) {
            const docCard = document.createElement("div");
            docCard.className = "doc-card";

            // Canvas ƒë·ªÉ hi·ªÉn th·ªã ·∫£nh preview
            const canvas = document.createElement("canvas");
            canvas.className = "preview-img";
            canvas.setAttribute("data-src", doc.file);
            canvas.onclick = () => openPreview(doc.file); // M·ªü ·∫£nh khi nh·∫•n

            const title = document.createElement("h3");
            title.textContent = doc.title;
            title.onclick = () => openPreview(doc.file); // Th√™m s·ª± ki·ªán click v√†o t√™n t√†i li·ªáu ƒë·ªÉ m·ªü preview

            const link = document.createElement("a");
            link.textContent = "üì• T·∫£i xu·ªëng";
            link.href = doc.file;
            link.className = "download-btn";
            link.setAttribute("download", doc.file);

            docCard.appendChild(canvas);
            docCard.appendChild(title);
            docCard.appendChild(link);

            loadPreviewImage(canvas); // G·ªçi h√†m render ·∫£nh xem tr∆∞·ªõc

            return docCard;
        }

        // H√†m t·∫£i ·∫£nh preview cho t√†i li·ªáu
        function loadPreviewImage(canvas, file) {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const filePath = entry.target.getAttribute("data-src");

                        // Ki·ªÉm tra n·∫øu l√† .pdf hay .docx ƒë·ªÉ x·ª≠ l√Ω kh√°c nhau
                        if (filePath.endsWith('.pdf')) {
                            generatePreview(filePath, entry.target); // Render PDF v√†o canvas
                        } else if (filePath.endsWith('.docx')) {
                            // Hi·ªÉn th·ªã h√¨nh ·∫£nh m·∫∑c ƒë·ªãnh cho .docx t·ª´ URL m·∫∑c ƒë·ªãnh
                            const context = entry.target.getContext("2d");
                            const img = new Image();
                            img.onload = function () {
                                context.drawImage(img, 0, 0, entry.target.width, entry.target.height);
                            };
                            img.src = 'https://w7.pngwing.com/pngs/854/300/png-transparent-microsoft-word-microsoft-office-2016-microsoft-excel-microsoft-template-blue-angle.png';  // Thay b·∫±ng URL c·ªßa h√¨nh ·∫£nh m·∫∑c ƒë·ªãnh cho .docx
                        }

                        observer.unobserve(entry.target);
                    }
                });
            }, { rootMargin: "100px" });

            observer.observe(canvas);
        }

        // H√†m t·∫°o preview ·∫£nh t·ª´ file PDF
        function generatePreview(pdfPath, canvasElement) {
            pdfjsLib.getDocument(pdfPath).promise.then(pdf => {
                pdf.getPage(1).then(page => {
                    const viewport = page.getViewport({ scale: 0.3 });
                    const context = canvasElement.getContext("2d");
                    canvasElement.height = viewport.height;
                    canvasElement.width = viewport.width;
                    page.render({ canvasContext: context, viewport: viewport });
                });
            }).catch(error => {
                console.error("Kh√¥ng th·ªÉ t·∫£i b·∫£n xem tr∆∞·ªõc PDF:", error);
            });
        }

        // H√†m m·ªü ·∫£nh trong lightbox (ph√≥ng to ·∫£nh PDF ho·∫∑c h√¨nh ·∫£nh)
        function openPreview(filePath) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightboxImage');
            const lightboxCanvas = document.getElementById('lightboxCanvas'); // Canvas cho PDF

            // Ki·ªÉm tra xem t√†i li·ªáu l√† PDF hay l√† h√¨nh ·∫£nh
            if (filePath.endsWith('.pdf')) {
                lightboxImage.style.display = 'none'; // ·∫®n image n·∫øu l√† PDF
                lightboxCanvas.style.display = 'block'; // Hi·ªÉn th·ªã canvas n·∫øu l√† PDF
                generatePreview(filePath, lightboxCanvas); // Render PDF v√†o canvas
            } else {
                lightboxCanvas.style.display = 'none'; // ·∫®n canvas n·∫øu l√† ·∫£nh
                lightboxImage.style.display = 'block'; // Hi·ªÉn th·ªã image n·∫øu l√† ·∫£nh
                lightboxImage.src = filePath; // C·∫≠p nh·∫≠t src c·ªßa ·∫£nh
            }

            lightbox.classList.add('active'); // Hi·ªÉn th·ªã lightbox
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
        }

        function delaySearch() {
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(filterDocs, 300);  // Delay t√¨m ki·∫øm ƒë·ªÉ tr√°nh qu√° t·∫£i
        }

        function filterDocs() {
            const searchQuery = document.getElementById("search").value.toLowerCase();

            if (searchQuery.length === 0) {
                loadDocumentsForClass(window.currentClass);  // N·∫øu kh√¥ng c√≥ t·ª´ kh√≥a, load l·∫°i t·∫•t c·∫£ t√†i li·ªáu
                return;
            }

            const filteredDocs = window.allDocuments.filter(doc => doc.title.toLowerCase().includes(searchQuery));

            const docList = document.getElementById("docList");
            docList.innerHTML = ""; // X√≥a danh s√°ch c≈©

            filteredDocs.forEach(doc => {
                const docCard = createDocCard(doc);
                docList.appendChild(docCard);
            });
        }

        // H√†m l·ªçc t√†i li·ªáu theo l·ªõp h·ªçc
        function filterByClass(className) {
            loadDocumentsForClass(className);  // L·ªçc t√†i li·ªáu theo l·ªõp h·ªçc
        }

        // G·ªçi h√†m load t√†i li·ªáu cho l·ªõp h·ªçc m·∫∑c ƒë·ªãnh khi trang t·∫£i
        document.addEventListener("DOMContentLoaded", () => {
            loadDocumentsForClass("Ten");  // T·∫£i t√†i li·ªáu l·ªõp "Ten" m·∫∑c ƒë·ªãnh
        });

    </script>
</body>

</html>